clear;
mal_folder_name='malware';
malwareLogFiles=dir(fullfile(mal_folder_name,'*.txt'));
malwareLogFiles(1).contents = [];
malware_numfiles = numel(malwareLogFiles);

benign_folder_name='benign';
benignLogFiles=dir(fullfile(benign_folder_name,'*.txt'));
benign_numfiles = length(benignLogFiles);

delimiter = '(';
formatSpec = '%s%*s%[^\n\r]';
alpha = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';

API = {};
for k = 1: malware_numfiles
    fprintf('extracting data from txt files :mal %d\n',k/malware_numfiles);
    filename = strcat(mal_folder_name,'\',malwareLogFiles(k).name);
    fileID = fopen(filename,'r');
    dataArray = textscan(fileID, formatSpec, 'Delimiter', delimiter,  'ReturnOnError', false);
    dataArray = dataArray{1};
    dellist = [1];
    for i=2:numel(dataArray)
        temp = dataArray{i};
        if numel(temp) >10
            if sum(ismember(temp(1),alpha))==0 || (strcmp(temp(1:10),'Executing:'))
                dellist = [dellist i];
            end
        end
    end
    
    fclose(fileID);
    dataArray(dellist) = [];
    API = [API dataArray{:}];
    malwareLogFiles(k).contents = dataArray;
    
    clearvars filename fileID dataArray ans;
end

for k = 1: benign_numfiles
    fprintf('extracting data from txt files :ben %d\n',k/benign_numfiles);
    filename = strcat(benign_folder_name ,'\', benignLogFiles(k).name);
    fileID = fopen(filename,'r');
    dataArray = textscan(fileID, formatSpec, 'Delimiter', delimiter,  'ReturnOnError', false);
    dataArray = dataArray{1};
    dellist = [1];
    for i=2:numel(dataArray)
        temp = dataArray{i};
        if numel(temp) >10
            if ~isstrprop(temp(1),'alpha') || (strcmp(temp(1:10),'Executing:'))
                dellist = [dellist i];
                
            end
        end
    end
    
    fclose(fileID);
    dataArray(dellist) = [];
    API = [API dataArray{:}];
    benignLogFiles(k).contents = dataArray;
    
    clearvars filename fileID dataArray ans;
end

api = unique(API);
for k = 1:numel(malwareLogFiles)
    fprintf('converting to api id : mal %d\n',k/malware_numfiles);
    
    dataArray = (malwareLogFiles(k).contents);
    for i=1:numel(dataArray)
        for j=1:numel(api)
            if strcmp(api{j}, dataArray{i})
                
                dataArray{i} = j;
            end
        end
    end
    dataArray = cell2mat(dataArray);
    
    malwareLogFiles(k).contents = dataArray;
end

for k = 1:numel(benignLogFiles)
    fprintf('converting to api id : ben %d\n',k/benign_numfiles);
    
    dataArray = (benignLogFiles(k).contents);
    for i=1:numel(dataArray)
        for j=1:numel(api)
            if strcmp(api{j}, dataArray{i})
                
                dataArray{i} = j;
            end
        end
    end
    dataArray = cell2mat(dataArray);
    benignLogFiles(k).contents = dataArray;
end

clearvars temp mal_folder_name i j k formatSpec dellist dataArray benign_folder_name API delimiter;